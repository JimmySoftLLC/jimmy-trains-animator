<!DOCTYPE html>
<html>
  <head>
    <title>Animator - Feller</title>
    <meta http-equiv="Content-type" content="text/html;charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      .loading {
        background-color: darkgray;
      }
    </style>
    <link rel="stylesheet" href="/mui.css" />
    <script src="/mui.min.js"></script>
  </head>

  <body>
    <div class="mui-container">
        <h1>Animator - Feller</h1>
        <br />
        <p class="dotted">
          Use this web app to control and calibrate your animator - feller
          product. Have fun animating.
      <ul class="mui-tabs__bar">
        <li class="mui--is-active">
          <a data-mui-toggle="tab" data-mui-controls="pane-events-1">Animations</a>
        </li>
        <li>
          <a data-mui-toggle="tab" data-mui-controls="pane-events-2">Adjust Feller</a>
        </li>
        <li>
          <a data-mui-toggle="tab" data-mui-controls="pane-events-3">Adjust Tree</a>
        </li>
      </ul>
      <div class="mui-tabs__pane" id="pane-events-2">dude 2</div>
      <div class="mui-tabs__pane" id="pane-events-3">dude 2</div>
      <div class="mui-tabs__pane mui--is-active" id="pane-events-1">

        </p>
        <br />

        <button
          class="mui-btn mui-btn--primary animator-feller"
          data-value="feller_home"
          data-url="/feller"
          data-redirect="http://animator-feller.local/table"
          type="button"
        >
          Goto table
        </button>

        <h2>Feller Animations:</h2>

        <button
          class="mui-btn mui-btn--primary animator-feller"
          data-value="random"
          data-url="/animation"
          type="button"
        >
          Random
        </button>
        <button
          class="mui-btn mui-btn--primary animator-feller disabled"
          data-value="forth_of_july"
          data-url="/animation"
          type="button"
        >
          Forth of July
        </button>
        <button
          class="mui-btn mui-btn--primary animator-feller"
          data-value="christmas"
          data-url="/animation"
          type="button"
        >
          Christmas
        </button>
        <button
          class="mui-btn mui-btn--primary animator-feller"
          data-value="halloween"
          data-url="/animation"
          type="button"
        >
          Halloween
        </button>
        <button
          class="mui-btn mui-btn--primary animator-feller"
          data-value="birds_dogs"
          data-url="/animation"
          type="button"
        >
          Birds and Dogs
        </button>
        <button
          class="mui-btn mui-btn--primary animator-feller"
          data-value="birds_dogs_short_version"
          data-url="/animation"
          type="button"
        >
          Birds and Dogs Short
        </button>
        <button
          class="mui-btn mui-btn--primary animator-feller"
          data-value="just_birds"
          data-url="/animation"
          type="button"
        >
          Just Birds
        </button>
        <button
          class="mui-btn mui-btn--primary animator-feller"
          data-value="machines"
          data-url="/animation"
          type="button"
        >
          Machine
        </button>
        <button
          class="mui-btn mui-btn--primary animator-feller"
          data-value="owl"
          data-url="/animation"
          type="button"
        >
          Owls
        </button>
        <button
          class="mui-btn mui-btn--primary animator-feller"
          data-value="no_sounds"
          data-url="/animation"
          type="button"
        >
          No other sounds
        </button>
        <button
          class="mui-btn mui-btn--primary animator-feller"
          data-value="train"
          data-url="/animation"
          type="button"
        >
          Train
        </button>
        <button
          class="mui-btn mui-btn--primary animator-feller"
          data-value="alien"
          data-url="/animation"
          type="button"
        >
          Alien
        </button>
        <button
          class="mui-btn mui-btn--primary animator-feller"
          data-value="happy_birthday"
          data-url="/animation"
          type="button"
        >
          Happy Birthday
        </button>
        <button
          class="mui-btn mui-btn--primary animator-feller"
          data-value="speaker_test"
          data-url="/animation"
          type="button"
        >
          Speaker Test
        </button>
        <button
          class="mui-btn mui-btn--primary animator-feller"
          data-value="cont_mode_on"
          data-url="/animation"
          type="button"
        >
          Continuous Mode On
        </button>
        <button
          class="mui-btn mui-btn--primary animator-feller"
          data-value="cont_mode_off"
          data-url="/animation"
          type="button"
        >
          Continuous Mode Off
        </button>

        <h2>Feller positions:</h2>

        <button
          class="mui-btn mui-btn--primary animator-feller"
          data-value="feller_rest_pos"
          data-url="/feller"
          type="button"
        >
          Rest
        </button>
        <button
          class="mui-btn mui-btn--primary animator-feller"
          data-value="feller_chop_pos"
          data-url="/feller"
          type="button"
        >
          Chop
        </button>
        <button
          class="mui-btn mui-btn--primary animator-feller"
          data-value="feller_adjust"
          data-url="/feller"
          data-redirect="/feller-adjust"
          type="button"
        >
          Adjust
        </button>

        <h2>Tree positions:</h2>

        <button
          class="mui-btn mui-btn--primary animator-feller"
          data-value="tree_up_pos"
          data-url="/tree"
          type="button"
        >
          Upright
        </button>
        <button
          class="mui-btn mui-btn--primary animator-feller"
          data-value="tree_down_pos"
          data-url="/tree"
          type="button"
        >
          Fallen
        </button>
        <button
          class="mui-btn mui-btn--primary animator-feller"
          data-value="tree_adjust"
          data-url="/tree"
          data-redirect="/tree-adjust"
          type="button"
        >
          Adjust
        </button>

        <h2>Dialog options:</h2>

        <button
          class="mui-btn mui-btn--primary animator-feller"
          data-value="opening_dialog_on"
          data-url="/dialog"
          type="button"
        >
          Opening dialog on
        </button>
        <button
          class="mui-btn mui-btn--primary animator-feller"
          data-value="opening_dialog_off"
          data-url="/dialog"
          type="button"
        >
          Opening dialog off
        </button>
        <button
          class="mui-btn mui-btn--primary animator-feller"
          data-value="feller_advice_on"
          data-url="/dialog"
          type="button"
        >
          Feller advice on
        </button>
        <button
          class="mui-btn mui-btn--primary animator-feller"
          data-value="feller_advice_off"
          data-url="/dialog"
          type="button"
        >
          Feller advice off
        </button>

        <h2>Animator web page name:</h2>

        <div class="mui-textfield">
          <input class="input" animator-feller" id="textInput" type="text"
          placeholder="Enter website name">
          <button
            id="submitButton"
            class="mui-btn mui-btn--primary"
            type="button"
            data-url="/update-host-name"
          >
            Change
          </button>
        </div>

        <p>
          Use alphanumerics and dashes only. All names are automatically
          appended with .local. So your website url will be something like
          "website-name.local"
        </p>
      </div>
      <div class="mui-tabs__pane" id="pane-default-2">Pane-2</div>
      <div class="mui-tabs__pane" id="pane-default-3">Pane-3</div>
    </div>
  </body>

  <script>
    var submitButton = document.getElementById('submitButton');

    // Get all buttons with the 'animator-feller' class
    var buttons = document.querySelectorAll('.animator-feller');

    submitButton.addEventListener('click', function () {
      var textInput = document.getElementById('textInput');
      var textValue = textInput.value;
      var url = this.getAttribute('data-url');

      var data = {
        text: textValue,
      };

      // Add 'loading' class to the submit button
      submitButton.classList.add('loading');

      fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
      })
        .then(function (response) {
          return response.text(); // assuming the response is plain text
        })
        .then(function (data) {
          textInput.value = data; // Set the value of the input field with the received data
          submitButton.classList.remove('loading');
        })
        .catch(function (error) {
          console.log(error);
        });
    });

    // Load initial data
    document.addEventListener('DOMContentLoaded', function () {
      fetch('/get-host-name', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
      })
        .then(function (response) {
          return response.text(); // assuming the response is plain text
        })
        .then(function (data) {
          textInput.value = data; // Set the value of the input field with the received data
        })
        .catch(function (error) {
          console.log(error);
        });
    });

    // Restrict input to letters, numbers, and hyphens only
    textInput.addEventListener('input', function () {
      var validatedValue = this.value.replace(/[^a-zA-Z0-9-]/g, '');
      this.value = validatedValue;
    });

    // Add click event listener to each button
    buttons.forEach(function (button) {
      button.addEventListener('click', function () {
        var animation = this.getAttribute('data-value');
        var url = this.getAttribute('data-url');
        var redirectUrl = this.getAttribute('data-redirect');
        if (!redirectUrl) button.setAttribute('disabled', 'true');

        // Create an object with the data to be sent in the request
        var data = {
          animation: animation,
        };

        // Make a POST request using fetch
        fetch(url, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
        })
          .then(function (response) {
            // Handle the response from the server
            if (redirectUrl) {
              window.location.href = redirectUrl;
            } else {
              button.removeAttribute('disabled');
            }
          })
          .catch(function (error) {
            button.removeAttribute('disabled');
            alert('Try Again');
          });
      });
    });
  </script>
</html>
