<!DOCTYPE html>
<html>

<head>
    <title>Animator - Christmas in the park</title>
    <meta http-equiv="Content-type" content="text/html;charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/mui.min.css" />
    <script src="/mui.min.js"></script>
</head>

<body>
    <div class="mui-container">
        <h1>Animator - Christmas in the park</h1>
        <p style="padding-top:0.5rem;">
            Use this web app to control and setup your animator - Christmas in the park
            product. Have fun animating.
        </p>
        <ul class="mui-tabs__bar">
            <li class="mui--is-active">
                <a data-mui-toggle="tab" data-mui-controls="animations">Animations</a>
            </li>
            <li>
                <a data-mui-toggle="tab" data-mui-controls="lightning">light string</a>
            </li>
            <li>
                <a data-mui-toggle="tab" data-mui-controls="settings">Settings</a>
            </li>
        </ul>

        <div class="mui-tabs__pane mui--is-active" id="animations" style="padding-top:0.5rem;">
            <button class="mui-btn mui-btn--primary animator-action" data-value="random" data-url="/animation"
                type="button">
                Random
            </button>
            <button class="mui-btn mui-btn--primary animator-action" data-value="we_wish_you_a_merry_christmas"
                data-url="/animation" type="button">
                we wish you a merry christmas
            </button>
            <button class="mui-btn mui-btn--primary animator-action" data-value="angels_we_have_heard_on_high"
                data-url="/animation" type="button">
                angels we have heard on high
            </button>
            <button class="mui-btn mui-btn--primary animator-action" data-value="joyful_snowman" data-url="/animation"
                type="button">
                joyful snowman
            </button>
            <button class="mui-btn mui-btn--primary animator-action" data-value="carol_of_the_bells"
                data-url="/animation" type="button">
                carol of the bells
            </button>
            <button class="mui-btn mui-btn--primary animator-action" data-value="dance_of_the_sugar_plum_fairy"
                data-url="/animation" type="button">
                dance of the sugar plum fairy
            </button>
            <button class="mui-btn mui-btn--primary animator-action" data-value="deck_the_halls_jazzy_version"
                data-url="/animation" type="button">
                deck the halls jazzy version
            </button>
            <button class="mui-btn mui-btn--primary animator-action" data-value="the_wassail_song" data-url="/animation"
                type="button">
                the wassail song
            </button>
            <button class="mui-btn mui-btn--primary animator-action" data-value="jingle_bells_orchestra"
                data-url="/animation" type="button">
                jingle bells orchestra
            </button>
            <button class="mui-btn mui-btn--primary animator-action" data-value="away_in_a_manger" data-url="/animation"
                type="button">
                away in a manger
            </button>
            <button class="mui-btn mui-btn--primary animator-action" data-value="joy_to_the_world" data-url="/animation"
                type="button">
                joy to the world
            </button>
            <button class="mui-btn mui-btn--primary animator-action" data-value="silent_night" data-url="/animation"
                type="button">
                silent night
            </button>
            <button class="mui-btn mui-btn--primary animator-action" data-value="auld_lang_syne_jazzy_version"
                data-url="/animation" type="button">
                auld lang syne jazzy version
            </button>
            <button class="mui-btn mui-btn--primary animator-action" data-value="cont_mode_on" data-url="/animation"
                type="button">
                Continuous Mode On
            </button>
            <button class="mui-btn mui-btn--primary animator-action" data-value="cont_mode_off" data-url="/animation"
                type="button">
                Continuous Mode Off
            </button>
        </div>
        <div class="mui-tabs__pane" id="lightning" style="padding-top:0.5rem;">
            <h2>Setup light string:</h2>
            <div class="mui-textfield">
                <p>
                    Enter your light string in the order which each component is connected together by pressing cane-4,
                    cane-4...
                    When finished press "Save".
                </p>
                <input class="input" id="lightString" type="text" disabled placeholder="No lights setup">
                <button class="mui-btn mui-btn--primary animator-light-update" type="button" data-action="save"
                    data-url="/update-light-string">
                    Save
                </button>
                <button class="mui-btn mui-btn--primary animator-light-update" type="button" data-action="clear"
                    data-url="/update-light-string">
                    Clear
                </button>
                <button class="mui-btn mui-btn--primary animator-light-update" type="button" data-action="defaults"
                    data-url="/update-light-string">
                    Set to defaults
                </button>
            </div>
            <div class="mui-textfield">
                <button class="mui-btn mui-btn--primary animator-light-update" type="button" data-action="cane-4"
                    data-url="/update-light-string">
                    cane-4
                </button>
                <button class="mui-btn mui-btn--primary animator-light-update" type="button" data-action="cane-4"
                    data-url="/update-light-string">
                    cane-4
                </button>
                <button class="mui-btn mui-btn--primary animator-light-update" type="button" data-action="canemidleft-4"
                    data-url="/update-light-string">
                    canemidleft-4
                </button>
                <button class="mui-btn mui-btn--primary animator-light-update" type="button"
                    data-action="canemidright-4" data-url="/update-light-string">
                    canemidright-4
                </button>
                <button class="mui-btn mui-btn--primary animator-light-update" type="button" data-action="canbackleft-4"
                    data-url="/update-light-string">
                    canebackleft-4
                </button>
                <button class="mui-btn mui-btn--primary animator-light-update" type="button" data-action="can-4"
                    data-url="/update-light-string">
                    can-4
                </button>
                <button class="mui-btn mui-btn--primary animator-light-update" type="button" data-action="star-2"
                    data-url="/update-light-string">
                    grandtree-21
                </button>
            </div>
            <h2>Test lights:</h2>
            <div>
                <button class="mui-btn mui-btn--primary animator-action" data-value="set_to_red" data-url="/lights"
                    type="button">
                    Red
                </button>
                <button class="mui-btn mui-btn--primary animator-action" data-value="set_to_green" data-url="/lights"
                    type="button">
                    Green
                </button>
                <button class="mui-btn mui-btn--primary animator-action" data-value="set_to_blue" data-url="/lights"
                    type="button">
                    Blue
                </button>
                <button class="mui-btn mui-btn--primary animator-action" data-value="set_to_white" data-url="/lights"
                    type="button">
                    White
                </button>
            </div>
            <div>
                <button class="mui-btn mui-btn--primary animator-action" data-value="set_to_0" data-url="/lights"
                    type="button">
                    Off
                </button>
                <button class="mui-btn mui-btn--primary animator-action" data-value="set_to_20" data-url="/lights"
                    type="button">
                    20
                </button>
                <button class="mui-btn mui-btn--primary animator-action" data-value="set_to_40" data-url="/lights"
                    type="button">
                    40
                </button>
                <button class="mui-btn mui-btn--primary animator-action" data-value="set_to_60" data-url="/lights"
                    type="button">
                    60
                </button>
                <button class="mui-btn mui-btn--primary animator-action" data-value="set_to_80" data-url="/lights"
                    type="button">
                    80
                </button>
                <button class="mui-btn mui-btn--primary animator-action" data-value="set_to_100" data-url="/lights"
                    type="button">
                    100
                </button>
            </div>
        </div>
        <div class="mui-tabs__pane" id="settings">
            <h2>Volume:</h2>
            <button class="mui-btn mui-btn--primary animator-action" data-value="volume_pot_on" data-url="/utilities"
                type="button">
                Volume Pot On
            </button>
            <button class="mui-btn mui-btn--primary animator-action" data-value="volume_pot_off" data-url="/utilities"
                type="button">
                Volume Pot Off
            </button>
            <div class="mui-textfield">
                <input class="input" id="volume" type="number" disabled>
                <button class="mui-btn mui-btn--primary animator-volume-update" type="button" data-url="/update-volume"
                    data-action="lower">
                    Lower Volume
                </button>
                <button class="mui-btn mui-btn--primary animator-volume-update" type="button" data-url="/update-volume"
                    data-action="raise">
                    Raise Volume
                </button>
            </div>

            <p>
                Valid volume levels are from 10 to 100
            </p>

            <h2>Animator web page name:</h2>

            <div class="mui-textfield">
                <input class="input" id="websiteUrl" type="text" placeholder="Enter website name">
                <button id="websiteSubmitButton" class="mui-btn mui-btn--primary" type="button"
                    data-url="/update-host-name">
                    Change
                </button>
            </div>

            <p>
                Use alphanumerics and dashes only. All names are automatically
                appended with .local. So your website url will be something like
                "website-name.local"
            </p>

            <h2>Utilities:</h2>
            <button class="mui-btn mui-btn--primary animator-action" data-value="speaker_test" data-url="/utilities"
                type="button">
                Speaker Test
            </button>
            <button class="mui-btn mui-btn--primary animator-action" data-value="reset_to_defaults"
                data-url="/utilities" type="button">
                Reset to defaults
            </button>
        </div>
    </div>
</body>

<script>
    // Load initial data after webpage loads
    document.addEventListener('DOMContentLoaded', function () {
        // get website url
        fetch('/get-host-name', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
        })
            .then(function (response) {
                return response.text(); // assuming the response is plain text
            })
            .then(function (data) {
                websiteUrl.value = data; // Set the value of the input field with the received data
            })
            .catch(function (error) {
                console.log(error);
            });

        // get volume
        fetch('/get-volume', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
        })
            .then(function (response) {
                return response.text(); // assuming the response is plain text
            })
            .then(function (data) {
                volume.value = data; // Set the value of the input field with the received data
            })
            .catch(function (error) {
                console.log(error);
            });

        // get light string
        fetch('/get-light-string', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
        })
            .then(function (response) {
                return response.text(); // assuming the response is plain text
            })
            .then(function (data) {
                lightString.value = data; // Set the value of the input field with the received data
            })
            .catch(function (error) {
                console.log(error);
            });
    });

    // Get all buttons with the 'animator-action' class
    // Add click event listener to each button
    var actionButtons = document.querySelectorAll('.animator-action');
    actionButtons.forEach(function (button) {
        button.addEventListener('click', function () {
            var url = button.getAttribute('data-url');
            var animation = button.getAttribute('data-value');
            var redirectUrl = button.getAttribute('data-redirect');

            // Create an object with the data to be sent in the request
            var data = {
                animation: animation,
            };

            button.setAttribute('disabled', 'true')

            // Make a POST request using fetch
            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
                .then(function (response) {
                    // Handle the response from the server
                    if (redirectUrl) {
                        window.location.href = redirectUrl;
                    } else {
                        button.removeAttribute('disabled');
                    }
                })
                .catch(function (error) {
                    button.removeAttribute('disabled');
                    alert('Try Again');
                });
        });
    });

    // Get all buttons with the 'animator-light-update' class
    // Add click event listener to each button
    var lightUpdateButtons = document.querySelectorAll('.animator-light-update');
    lightUpdateButtons.forEach(function (button) {
        button.addEventListener('click', function () {
            var url = this.getAttribute('data-url');
            var action = this.getAttribute('data-action');
            var data = {}
            if (action == "save" || action == "clear" || action == "defaults") {
                var lightStringElement = document.getElementById('lightString');
                lightStringValue = lightStringElement.value
                if (action == "defaults") lightStringValue = "cane-4,cane-4,cane-4,cane-4,cane-4,cane-4,grandtree-21"
                if (action == "clear") lightStringValue = ""
                data = {
                    text: lightStringValue,
                    action: action
                }
            } else {
                data = {
                    text: action,
                    action: action
                }
            }
            button.setAttribute('disabled', 'true')
            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
                .then(function (response) {
                    return response.text(); // assuming the response is plain text
                })
                .then(function (data) {
                    lightString.value = data; // Set the value of the input field with the received data
                    button.removeAttribute('disabled')
                })
                .catch(function (error) {
                    console.log(error);
                    button.removeAttribute('disabled')
                });
        });
    });

    // Get all buttons with the 'animator-light-update' class
    // Add click event listener to each button
    var volumeUpdateButtons = document.querySelectorAll('.animator-volume-update');
    volumeUpdateButtons.forEach(function (button) {
        button.addEventListener('click', function () {
            var url = this.getAttribute('data-url');
            var action = this.getAttribute('data-action');
            data = {
                action: action
            }

            button.setAttribute('disabled', 'true')
            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
                .then(function (response) {
                    return response.text(); // assuming the response is plain text
                })
                .then(function (data) {
                    volume.value = data; // Set the value of the input field with the received data
                    button.removeAttribute('disabled')
                })
                .catch(function (error) {
                    console.log(error);
                    button.removeAttribute('disabled')
                });
        });
    });

    // Add click event listener to website submit button
    var websiteSubmitButton = document.getElementById('websiteSubmitButton');
    websiteSubmitButton.addEventListener('click', function () {
        var websiteUrl = document.getElementById('websiteUrl');
        var websiteUrlText = websiteUrl.value;
        var url = this.getAttribute('data-url');

        var data = {
            text: websiteUrlText,
        };

        websiteSubmitButton.setAttribute('disabled', 'true')

        fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
        })
            .then(function (response) {
                return response.text(); // assuming the response is plain text
            })
            .then(function (data) {
                websiteUrl.value = data; // Set the value of the input field with the received data
                websiteSubmitButton.removeAttribute('disabled')
            })
            .catch(function (error) {
                console.log(error);
                websiteSubmitButton.removeAttribute('disabled')
            });
    });

    // Restrict input to letters, numbers, and hyphens only
    websiteUrl.addEventListener('input', function () {
        var validatedValue = this.value.replace(/[^a-zA-Z0-9-]/g, '');
        this.value = validatedValue;
    });
</script>

</html>