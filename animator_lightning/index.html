<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Editable Table</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <style>
        html {
            font-family: monospace;
            background-color: lightgrey;
            display: inline-block;
            margin: 0px auto;
            text-align: center;
        }

        h1 {
            color: deeppink;
            width: 200;
            word-wrap: break-word;
            padding: 2vh;
            font-size: 35px;
        }

        p {
            font-size: 1.5rem;
            width: 200;
            word-wrap: break-word;
        }

        .non-editable {
            font-family: monospace;
            display: inline-block;
            background-color: rgb(255, 255, 255);
            border: saddlebrown;
            border-radius: 4px;
            color: gray;
            padding: 16px 40px;
            text-decoration: none;
            font-size: 30px;
            margin: 2px;
            pointer-events: none;
            user-select: none;
        }

        .button {
            font-family: monospace;
            display: inline-block;
            background-color: black;
            border: none;
            border-radius: 4px;
            color: white;
            padding: 16px 40px;
            text-decoration: none;
            font-size: 30px;
            margin: 2px;
            cursor: pointer;
        }

        .loading {
            background-color: darkgray;
        }

        .input {
            font-family: monospace;
            display: inline-block;
            background-color: rgb(255, 255, 255);
            border: saddlebrown;
            border-radius: 4px;
            color: rgb(0, 0, 0);
            padding: 16px 40px;
            text-decoration: none;
            font-size: 30px;
            margin: 2px;
            cursor: pointer;
        }

        p.dotted {
            margin: auto;
            width: 75%;
            font-size: 25px;
            text-align: center;
        }
    </style>
</head>

<body>
  <div class="container">
    <h1>Editable Table</h1>

    <button id="fetchDataButton" class="btn btn-primary mb-3" type="button">Fetch Data</button>
    <button id="saveDataButton" class="btn btn-primary mb-3" type="button">Save Data</button>

    <table id="dataTable" class="table table-striped">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Email</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <h1>Animator - Feller</h1>
    <br>
    <p class="dotted">Use this web app to control and calibrate your animator - feller product. Have fun animating.</p>
    <br>

    <h1>Animator web page name:</h1><br>

    <form accept-charset="utf-8" method="POST">
        <input class="input" animator-feller" id="textInput" type="text" placeholder="Enter website name"><span
            class="non-editable">.local</span>
        <button id="submitButton" class="button" type="button" data-url="/update-host-name">Change</button>
    </form>

    <p class="dotted">Use alphanumerics and dashes only. All names are automatically appended with .local. For example
        type, website-name.local, in your browser.</your-name></p>

  </div>

  <script>
    var fetchDataButton = document.getElementById("fetchDataButton");
    var saveDataButton = document.getElementById("saveDataButton");
    var dataTable = document.getElementById("dataTable");
    var dataTableBody = document.querySelector("#dataTable tbody");
    
    var submitButton = document.getElementById("submitButton");

    // Get all buttons with the 'animator-feller' class
    var buttons = document.querySelectorAll(".animator-feller");

    submitButton.addEventListener("click", function () {
        var textInput = document.getElementById("textInput");
        var textValue = textInput.value;
        var url = this.getAttribute("data-url");

        var data = {
            text: textValue
        };

        // Add 'loading' class to the submit button
        submitButton.classList.add("loading");

        fetch(url, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(data)
        })
            .then(function (response) {
                return response.text(); // assuming the response is plain text
            })
            .then(function (data) {
                textInput.value = data; // Set the value of the input field with the received data
                submitButton.classList.remove("loading");
            })
            .catch(function (error) {
                console.log(error);
            });
    });

    // Load initial data
    document.addEventListener("DOMContentLoaded", function () {
        fetch("/get-host-name", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            }
        })
            .then(function (response) {
                return response.text(); // assuming the response is plain text
            })
            .then(function (data) {
                textInput.value = data; // Set the value of the input field with the received data
            })
            .catch(function (error) {
                console.log(error);
            });
    });

    // Restrict input to letters, numbers, and hyphens only
    textInput.addEventListener("input", function () {
        var validatedValue = this.value.replace(/[^a-zA-Z0-9-]/g, "");
        this.value = validatedValue;
    });

    fetchDataButton.addEventListener("click", function() {
      fetchData();
    });
    
    saveDataButton.addEventListener("click", function() {
      saveData();
    });

    dataTableBody.addEventListener("click", function(event) {
      var target = event.target;
      if (target.classList.contains("insert-row-btn")) {
        insertRow(target.parentNode.parentNode);
      } else if (target.classList.contains("delete-row-btn")) {
        deleteRow(target.parentNode.parentNode);
      } else if (target.classList.contains("add-row-btn")) {
        addRow(target.parentNode.parentNode);
      }
    });

    function fetchData() {
      // Simulate API call delay
      setTimeout(function() {
        var fakeData = [
          { id: 1, name: "John Doe", email: "john@example.com" },
          { id: 2, name: "Jane Smith", email: "jane@example.com" },
          { id: 3, name: "Robert Johnson", email: "robert@example.com" }
        ];

        populateTable(fakeData);
      }, 1000); // Simulated delay of 1 second
    }

    function populateTable(data) {
      // Clear existing table rows
      dataTableBody.innerHTML = "";

      // Populate table with new data
      data.forEach(function(rowData) {
        var row = createDataRow(rowData);
        dataTableBody.appendChild(row);
      });
    }

    function createDataRow(rowData) {
      var row = document.createElement("tr");

      var idCell = createEditableCell(rowData.id);
      row.appendChild(idCell);

      var nameCell = createEditableCell(rowData.name);
      row.appendChild(nameCell);

      var emailCell = createEditableCell(rowData.email);
      row.appendChild(emailCell);

      var actionCell = document.createElement("td");

      var insertButton = createInsertButton();
      actionCell.appendChild(insertButton);
      var addButton = createAddButton();
      actionCell.appendChild(addButton);
      row.appendChild(actionCell);
      var deleteButton = createDeleteButton();
      actionCell.appendChild(deleteButton);

      return row;
    }

    function createEditableCell(value) {
      var cell = document.createElement("td");
      var input = document.createElement("input");
      input.type = "text";
      input.className = "form-control";
      input.value = value;
      cell.appendChild(input);
      return cell;
    }

    function createDeleteButton() {
      var button = document.createElement("button");
      button.type = "button";
      button.className = "btn btn-danger btn-sm delete-row-btn pl-1";
      button.textContent = "Delete";
      return button;
    }

    function createInsertButton() {
      var button = document.createElement("button");
      button.type = "button";
      button.className = "btn btn-success btn-sm insert-row-btn pl-1";
      button.textContent = "Insert";
      return button;
    }

    function createAddButton() {
      var button = document.createElement("button");
      button.type = "button";
      button.className = "btn btn-primary btn-sm add-row-btn pl-1";
      button.textContent = "Add";
      return button;
    }

    function deleteRow(row) {
      row.parentNode.removeChild(row);
    }

    function insertRow(row) {
      var newRow = createDataRow({ id: "", name: "", email: "" });
      dataTableBody.insertBefore(newRow, row);
    }

    function insertAfter(newNode, existingNode) {
    existingNode.parentNode.insertBefore(newNode, existingNode.nextSibling);
    }

    function addRow(row) {
      var newRow = createDataRow({ id: "", name: "", email: "" });
      insertAfter(newRow, row);
    }
    
    function saveData() {
      var rows = Array.from(dataTableBody.querySelectorAll("tr"));

    // Extract data from table rows
    var data = rows.map(function(row) {
      var cells = Array.from(row.querySelectorAll("td"));
      var values = cells.map(function(cell) {
        var input = cell.querySelector("input");
        return input ? input.value : "";
      });
      return values;
    });

      // Send data to the server
      fetch("YOUR_API_ENDPOINT", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(data)
      })
        .then(function(response) {
          if (response.ok) {
            alert("Data saved successfully!");
          } else {
            alert("Error saving data. Please try again.");
          }
        })
        .catch(function(error) {
          alert("An error occurred. Please try again later.");
        });
    }
  </script>
</body>

</html>